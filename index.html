<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bete-Saida Pharmacy | Stock Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-blue: #0a1f3d;
            --dark-blue: #061224;
            --medium-blue: #1a3a6c;
            --light-blue: #2d5aa0;
            --accent-blue: #3a7bd5;
            --gold: #ffd700;
            --light-gold: #fff8dc;
            --dark-gold: #b8860b;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
            --gray: #8da0c7;
            --light: #e6f0ff;
            --flash-green: #00ff00;
            --flash-dark-green: #00cc00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 50%, var(--medium-blue) 100%);
            color: var(--light);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            font-size: 14px;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: var(--gold);
            border-radius: 50%;
            opacity: 0.1;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, 50px) rotate(90deg); }
            50% { transform: translate(40px, 20px) rotate(180deg); }
            75% { transform: translate(20px, 30px) rotate(270deg); }
        }

        @keyframes greenFlash {
            0%, 100% { 
                color: #ff0000;
                text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            }
            50% { 
                color: var(--flash-green);
                text-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
            }
        }

        @keyframes logoFlash {
            0%, 100% { 
                background: linear-gradient(to right, var(--gold), var(--light-gold));
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
            }
            50% { 
                background: linear-gradient(to right, var(--flash-green), var(--flash-dark-green));
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                text-shadow: 0 2px 20px rgba(0, 255, 0, 0.5);
            }
        }

        .welcome-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 50%, var(--medium-blue) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .welcome-content {
            text-align: center;
            padding: 1rem;
            max-width: 90%;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-title {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
            text-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            letter-spacing: 1px;
            font-weight: 800;
            line-height: 1.2;
        }

        .welcome-owner {
            font-size: 1.8rem;
            color: var(--light-gold);
            margin-bottom: 2rem;
            font-style: italic;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
        }

        .fullscreen-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--gold);
            color: var(--gold);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            z-index: 10001;
            transition: all 0.3s ease;
        }

        .fullscreen-toggle:hover {
            background: var(--gold);
            color: var(--primary-blue);
            transform: scale(1.1);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .login-input-group {
            text-align: left;
        }

        .login-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--gold);
            font-weight: 600;
        }

        .login-input-group input, .login-input-group select {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
        }

        .login-input-group input:focus, .login-input-group select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .login-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .login-btn {
            background: linear-gradient(145deg, var(--gold), var(--dark-gold));
            color: var(--primary-blue);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 150px;
            justify-content: center;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            margin: 0;
            position: relative;
            z-index: 1;
            padding: 10px;
            display: none;
            overflow-y: auto;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 50%, var(--medium-blue) 100%);
        }

        header {
            background: linear-gradient(145deg, rgba(10, 31, 61, 0.95), rgba(26, 58, 108, 0.95));
            padding: 1rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 215, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logo-icon {
            background: linear-gradient(145deg, var(--gold), var(--dark-gold));
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            animation: pulse 2s infinite;
        }

        .logo-icon i {
            font-size: 2rem;
            color: var(--primary-blue);
        }

        .logo-text h1 {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: 1px;
            text-align: center;
            animation: logoFlash 3s infinite;
        }

        .guideline-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--gold);
            color: var(--gold);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .guideline-btn:hover {
            background: var(--gold);
            color: var(--primary-blue);
            transform: scale(1.1);
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: var(--gold) rgba(255, 215, 0, 0.1);
            flex-wrap: nowrap;
            justify-content: space-between;
        }

        .nav-buttons::-webkit-scrollbar {
            height: 6px;
        }

        .nav-buttons::-webkit-scrollbar-track {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 3px;
        }

        .nav-buttons::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 3px;
        }

        .nav-btn {
            flex: 1;
            min-width: 100px;
            padding: 1rem 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            color: var(--light);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-size: 0.9rem;
            min-height: 60px;
            text-align: center;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: rgba(255, 215, 0, 0.15);
            border-color: var(--gold);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.2);
        }

        .nav-btn i {
            color: var(--gold);
            font-size: 1.2rem;
        }

        .pharmacy-info-container {
            background: linear-gradient(145deg, rgba(10, 31, 61, 0.95), rgba(26, 58, 108, 0.95));
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
            flex-grow: 1;
        }

        .pharmacy-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .pharmacy-header h2 {
            color: var(--gold);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .owner-name {
            font-size: 3rem !important;
            font-weight: 900 !important;
            text-align: center;
            margin: 2rem 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: greenFlash 3s infinite;
        }

        .locations-section {
            margin-top: 1.5rem;
        }

        .locations-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .locations-grid {
                grid-template-columns: 1fr;
            }
        }

        .location-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.2rem;
            border: 1px solid rgba(255, 215, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-card:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }

        .location-card h4 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .location-card p {
            font-size: 1rem;
            color: var(--gray);
        }

        .footer-section {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .footer-section p {
            color: var(--gray);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .full-screen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-blue);
            z-index: 2000;
            display: none;
            overflow-y: auto;
            padding: 10px;
        }

        .full-screen-mode.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .full-screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .full-screen-header h2 {
            color: var(--gold);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-full-screen {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            color: var(--gold);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .form-container {
            max-width: 100%;
            margin: 0 auto;
            background: linear-gradient(145deg, rgba(10, 31, 61, 0.9), rgba(26, 58, 108, 0.9));
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--light);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--light);
            transition: all 0.3s ease;
        }

        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='gold' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .value-display {
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--gold);
            text-align: center;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(145deg, var(--gold), var(--dark-gold));
            color: var(--primary-blue);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--gold);
        }

        .btn-view {
            background: rgba(58, 123, 213, 0.2);
            color: var(--light);
            border: 2px solid rgba(58, 123, 213, 0.4);
        }

        .btn-view:hover {
            background: rgba(58, 123, 213, 0.3);
            border-color: var(--accent-blue);
        }

        .sales-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .sales-control-btn {
            flex: 1;
            min-width: 180px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.3);
            color: var(--light);
            padding: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .table-container {
            overflow: auto;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            margin-top: 1rem;
            max-height: calc(100vh - 250px);
            max-width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        thead {
            background: linear-gradient(145deg, var(--medium-blue), var(--light-blue));
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--gold);
            white-space: nowrap;
        }

        tbody tr {
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        td {
            padding: 1rem;
            color: var(--light);
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-instock { background: var(--success); }
        .status-alert { background: var(--warning); }
        .status-low { background: #ffaa00; }
        .status-out { background: var(--danger); }
        .status-near-expiry { background: #ff7700; }
        .status-expired { background: #cc0000; }
        .status-damaged { background: #ff0066; }
        .status-reorder { background: #00aaff; }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-blue);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        }

        .toast {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--light);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateX(100%);
            opacity: 0;
            animation: slideIn 0.3s ease forwards;
            max-width: 300px;
            font-size: 0.9rem;
        }

        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .search-filter {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold);
        }

        .search-box input {
            width: 100%;
            padding: 0.8rem 0.8rem 0.8rem 2.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--light);
        }

        .filter-select {
            min-width: 180px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .dashboard-card {
            background: linear-gradient(145deg, rgba(10, 31, 61, 0.9), rgba(26, 58, 108, 0.9));
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .dashboard-card h3 {
            color: var(--gold);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .dashboard-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--light);
            text-align: center;
            margin: 1rem 0;
        }

        .dashboard-card .sub-value {
            font-size: 0.9rem;
            color: var(--gray);
            text-align: center;
        }

        .data-management-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .data-management-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .data-management-card h4 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1rem;
        }

        .sales-table-container {
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .sales-table th, .sales-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .sales-table th {
            background: rgba(255, 215, 0, 0.1);
            color: var(--gold);
            font-weight: 600;
        }

        .report-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-blue);
            z-index: 3000;
            display: none;
            padding: 0;
        }

        .report-preview-modal.active {
            display: block;
        }

        .report-preview-content {
            background: var(--dark-blue);
            padding: 1.5rem;
            width: 100%;
            height: 100%;
            overflow: auto;
            border: none;
        }

        .guideline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-blue);
            z-index: 3000;
            display: none;
            overflow-y: auto;
            padding: 10px;
        }

        .guideline-modal.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .guideline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .guideline-header h2 {
            color: var(--gold);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-guideline {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            color: var(--gold);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .guideline-content {
            background: linear-gradient(145deg, rgba(10, 31, 61, 0.9), rgba(26, 58, 108, 0.9));
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .guideline-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .guideline-section h3 {
            color: var(--gold);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guideline-section p {
            color: var(--light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .guideline-list {
            list-style-type: none;
            padding-left: 1rem;
        }

        .guideline-list li {
            color: var(--light);
            margin-bottom: 0.8rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .guideline-list li:before {
            content: "•";
            color: var(--gold);
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -3px;
        }

        @media (max-width: 1200px) {
            .nav-buttons {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                flex: 1 0 calc(25% - 0.8rem);
                min-width: 120px;
            }
        }

        @media (max-width: 768px) {
            .welcome-title {
                font-size: 1.8rem;
            }
            
            .welcome-owner {
                font-size: 1.4rem;
            }
            
            .owner-name {
                font-size: 2rem !important;
            }
            
            .nav-btn {
                flex: 1 0 calc(33.333% - 0.8rem);
                min-width: 100px;
                font-size: 0.9rem;
                padding: 1rem 0.3rem;
                min-height: 60px;
            }
            
            .nav-btn i {
                font-size: 1.2rem;
            }
            
            .locations-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .search-box, .filter-select {
                min-width: 100%;
            }
            
            .logo-text h1 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .nav-btn {
                flex: 1 0 calc(50% - 0.8rem);
                min-width: 90px;
                font-size: 0.8rem;
                min-height: 50px;
            }
            
            .logo-text h1 {
                font-size: 1.2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .welcome-title {
                font-size: 1.5rem;
            }
            
            .welcome-owner {
                font-size: 1.2rem;
            }
            
            .owner-name {
                font-size: 1.5rem !important;
            }
        }

        @media (max-width: 360px) {
            body {
                font-size: 12px;
            }
            
            .nav-btn {
                flex: 1 0 100%;
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 0.8rem;
                font-size: 0.8rem;
            }
        }
        
        .audit-alert {
            background: rgba(255, 68, 68, 0.1);
            border-left: 4px solid var(--danger);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        
        .audit-warning {
            background: rgba(255, 170, 0, 0.1);
            border-left: 4px solid var(--warning);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        
        .audit-info {
            background: rgba(58, 123, 213, 0.1);
            border-left: 4px solid var(--accent-blue);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        
        .profit-positive {
            color: var(--success);
            font-weight: bold;
        }
        
        .profit-negative {
            color: var(--danger);
            font-weight: bold;
        }
        
        .profit-neutral {
            color: var(--gray);
        }

        .unit-conversion {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-top: 0.5rem;
        }

        .audit-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .audit-summary-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audit-summary-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .audit-summary-item h4 {
            color: var(--gold);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .audit-summary-value {
            font-size: 1.2rem;
            color: var(--light);
            font-weight: bold;
        }

        .clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clickable:hover {
            transform: translateY(-2px);
        }
        
        .page-link {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .page-link:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .datalist-input {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--light);
            transition: all 0.3s ease;
        }
        
        .datalist-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .user-nav-btn {
            display: block !important;
        }
        
        .admin-nav-btn {
            display: block !important;
        }
        
        .sales-search-item {
            width: 100%;
            padding: 0.8rem 0.8rem 0.8rem 2.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--light);
        }
        
        .sales-search-item:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }
        
        .mixed-unit-display {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            margin-top: 0.3rem;
            font-size: 0.9rem;
            color: var(--gold);
        }
        
        .conversion-info {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 0.3rem;
        }
        
        /* Real-time notification */
        .realtime-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--success);
            color: var(--light);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            z-index: 10001;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .ws-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--light);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ws-status.online {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success);
        }
        
        .ws-status.offline {
            background: rgba(255, 68, 68, 0.1);
            border-color: var(--danger);
        }
        
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: var(--light);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="welcome-page" id="welcomePage">
        <button class="fullscreen-toggle" id="fullscreenToggle">
            <i class="fas fa-expand"></i>
        </button>
        <div class="welcome-content">
            <h1 class="welcome-title">Bete-Saida Pharmacy Stock Management</h1>
            <div class="welcome-owner">Esubalew Biyazin</div>
            
            <div class="login-form" id="loginForm">
                <div class="login-input-group">
                    <label for="loginType"><i class="fas fa-user-tag"></i> Login Type</label>
                    <select id="loginType" required>
                        <option value="">Select login type...</option>
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <div class="login-input-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" required placeholder="Enter password...">
                </div>
                
                <div class="login-buttons">
                    <button class="login-btn" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="particles" id="particles"></div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Initializing System...</div>
    </div>
    
    <!-- Real-time Notification -->
    <div class="realtime-notification" id="realtimeNotification">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span id="notificationText">Real-time updates enabled</span>
    </div>
    
    <!-- WebSocket Status -->
    <div class="ws-status offline" id="wsStatus">
        <i class="fas fa-circle"></i>
        <span>Connecting...</span>
    </div>
    
    <!-- Sync Status -->
    <div class="sync-status" id="syncStatus">
        <i class="fas fa-check"></i>
        <span>Synced</span>
    </div>
    
    <div class="container" id="mainContainer">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-pills"></i>
                </div>
                <div class="logo-text">
                    <h1>Bete-Saida Pharmacy – Stock Management – 2026</h1>
                </div>
            </div>
            
            <button class="guideline-btn" id="guidelineBtn">
                <i class="fas fa-book"></i>
            </button>
        </header>
        
        <div class="nav-buttons">
            <button class="nav-btn user-nav-btn admin-nav-btn" id="navRegisterStock">
                <i class="fas fa-pills"></i>
                <span>Register</span>
            </button>
            <button class="nav-btn user-nav-btn admin-nav-btn" id="navSales">
                <i class="fas fa-shopping-cart"></i>
                <span>Sales</span>
            </button>
            <button class="nav-btn user-nav-btn admin-nav-btn" id="navCurrentStock">
                <i class="fas fa-list-alt"></i>
                <span>Inventory</span>
            </button>
            <button class="nav-btn user-nav-btn admin-nav-btn" id="navAddStock">
                <i class="fas fa-arrow-down"></i>
                <span>Add</span>
            </button>
            <button class="nav-btn user-nav-btn admin-nav-btn" id="navReduceStock">
                <i class="fas fa-arrow-up"></i>
                <span>Deduct</span>
            </button>
            <button class="nav-btn admin-nav-btn" id="navReview" style="display: none;">
                <i class="fas fa-chart-bar"></i>
                <span>Review</span>
            </button>
            <button class="nav-btn admin-nav-btn" id="navAudit" style="display: none;">
                <i class="fas fa-shield-alt"></i>
                <span>Audit</span>
            </button>
            <button class="nav-btn admin-nav-btn" id="navReports" style="display: none;">
                <i class="fas fa-file-export"></i>
                <span>Reports</span>
            </button>
            <button class="nav-btn admin-nav-btn" id="navDataManagement" style="display: none;">
                <i class="fas fa-database"></i>
                <span>Data</span>
            </button>
        </div>

        <div class="pharmacy-info-container">
            <div class="pharmacy-header">
                <h2>BETE‑SAIDA PHARMACY</h2>
            </div>
            
            <div class="owner-name">
                ESUBALEW BIYAZIN
            </div>
            
            <div class="locations-section">
                <h3 style="color: var(--gold); margin-bottom: 0.8rem; text-align: center;">Our Locations</h3>
                <div class="locations-grid">
                    <div class="location-card page-link" data-page="registerStockPage">
                        <h4>Merkeb Jabo House</h4>
                        <p>Main branch with full services</p>
                    </div>
                    <div class="location-card page-link" data-page="addStockPage">
                        <h4>Bete‑Saida No.1</h4>
                        <p>Primary pharmacy location</p>
                    </div>
                    <div class="location-card page-link" data-page="salesPage">
                        <h4>Bete‑Saida No.2</h4>
                        <p>Secondary branch for extended reach</p>
                    </div>
                </div>
            </div>
            
            <div class="footer-section" id="contact">
                <p>© 2026 Bete‑Saida Pharmacy | All Rights Reserved</p>
                <p id="connectionStatus">Connecting to server...</p>
            </div>
        </div>
    </div>

    <!-- Register Stock Page -->
    <div class="full-screen-mode" id="registerStockPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-pills"></i> Register Stock Item</h2>
            <button class="close-full-screen" id="closeRegisterStock">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <form id="stockForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="itemName">
                            <i class="fas fa-capsules"></i> Item Name *
                        </label>
                        <input type="text" id="itemName" required placeholder="Enter medicine name">
                    </div>
                    <div class="form-group">
                        <label for="category">
                            <i class="fas fa-tags"></i> Category *
                        </label>
                        <input list="categoryList" id="category" class="datalist-input" required placeholder="Type or select category">
                        <datalist id="categoryList">
                            <option value="Analgesics / Painkillers">
                            <option value="Antipyretics">
                            <option value="Antibiotics / Antimicrobials">
                            <option value="Antifungals">
                            <option value="Antivirals">
                            <option value="Antihypertensives">
                            <option value="Diuretics">
                            <option value="Antidiabetics">
                            <option value="Cardiovascular Drugs">
                            <option value="Respiratory Drugs / Bronchodilators">
                            <option value="Gastrointestinal Drugs">
                            <option value="Antacids">
                            <option value="Vitamins / Supplements">
                            <option value="Hormones / Endocrine Drugs">
                            <option value="Antidepressants / Psychotropics">
                            <option value="Anticonvulsants / Antiepileptics">
                            <option value="Immunologicals / Vaccines">
                            <option value="Ophthalmic Preparations">
                            <option value="Otic / Ear Preparations">
                            <option value="Nasal Preparations">
                            <option value="Topical Agents / Dermatologicals">
                            <option value="Anesthetics">
                            <option value="Anticoagulants / Antiplatelets">
                            <option value="Anti-inflammatory Drugs / NSAIDs">
                            <option value="Anti-malarials">
                            <option value="Anthelmintics">
                            <option value="Chemotherapeutic Agents / Antineoplastics">
                            <option value="Immunosuppressants">
                            <option value="Respiratory Allergens / Antihistamines">
                            <option value="Anti-obesity Drugs">
                            <option value="Anti-ulcer Agents / Proton Pump Inhibitors">
                            <option value="Laxatives / Stool Softeners">
                            <option value="Anti-emetics / Antinausea">
                            <option value="Cardiotonic / Heart Failure Drugs">
                            <option value="Muscle Relaxants">
                            <option value="Sedatives / Hypnotics">
                            <option value="Cold & Flu Preparations">
                            <option value="Oral Contraceptives / Reproductive Drugs">
                            <option value="Electrolytes / Mineral Supplements">
                            <option value="Ophthalmic Anti-infectives">
                            <option value="Dermatological Antibiotics">
                            <option value="Skin Protectants / Emollients">
                            <option value="Hematological Agents / Blood Products">
                            <option value="Thrombolytics">
                            <option value="Anti-Parkinson Drugs">
                            <option value="Anti-psychotics">
                            <option value="Anti-anxiety Agents">
                            <option value="Anti-addiction / Withdrawal Drugs">
                            <option value="Bone / Calcium Preparations">
                            <option value="Anti-gout Agents">
                            <option value="Anti-thyroid Drugs">
                            <option value="Anti-diarrheal Agents">
                            <option value="Anti-spasmodic">
                            <option value="Antiseptics / Disinfectants">
                            <option value="Diagnostic Agents / Contrast Media">
                            <option value="Vaccines – Live">
                            <option value="Vaccines – Inactivated">
                            <option value="Ophthalmic Lubricants">
                            <option value="Topical Corticosteroids">
                            <option value="Anti-viral Topical Agents">
                            <option value="Chemoprotective Agents">
                            <option value="Growth Hormones">
                            <option value="Anti-arrhythmic Drugs">
                            <option value="Anti-anginal Drugs">
                            <option value="Peripheral Vasodilators">
                            <option value="Anti-fibrotic Agents">
                            <option value="Hemostatic Agents">
                            <option value="Anti-cholinergic Drugs">
                            <option value="Cholinergic Drugs">
                            <option value="Anti-migraine Agents">
                            <option value="Smoking Cessation Aids">
                            <option value="Anabolic Steroids">
                            <option value="Enzyme Preparations">
                            <option value="Antihyperlipidemic / Lipid-lowering Drugs">
                        </datalist>
                    </div>
                    
                    <!-- BASE UNIT SECTION -->
                    <div class="form-group">
                        <label for="baseUnit">
                            <i class="fas fa-balance-scale"></i> Base Unit *
                        </label>
                        <select id="baseUnit" required>
                            <option value="">Select base unit...</option>
                            <option value="tablet">Tablet</option>
                            <option value="capsule">Capsule</option>
                            <option value="ml">ml</option>
                            <option value="mg">mg</option>
                            <option value="g">g</option>
                            <option value="piece">Piece</option>
                            <option value="unit">Unit</option>
                            <option value="dose">Dose</option>
                            <option value="injection">Injection</option>
                            <option value="patch">Patch</option>
                        </select>
                        <div class="conversion-info">
                            Base unit is the smallest indivisible unit. All quantities are stored in base units.
                        </div>
                    </div>
                    
                    <!-- REGISTERED UNIT SECTION -->
                    <div class="form-group">
                        <label for="registeredUnit">
                            <i class="fas fa-box"></i> Registered Unit *
                        </label>
                        <input list="registeredUnitList" id="registeredUnit" class="datalist-input" required placeholder="Type registered unit (e.g., box, strip)">
                        <datalist id="registeredUnitList">
                            <option value="box">
                            <option value="strip">
                            <option value="bottle">
                            <option value="pack">
                            <option value="carton">
                            <option value="jar">
                            <option value="tube">
                            <option value="sachet">
                            <option value="vial">
                            <option value="ampoule">
                        </datalist>
                    </div>
                    
                    <div class="form-group">
                        <label for="registeredToBaseFactor">
                            <i class="fas fa-exchange-alt"></i> Registered → Base Factor *
                        </label>
                        <input type="number" id="registeredToBaseFactor" min="1" step="1" value="1" required placeholder="1 registered unit = ? base units">
                        <div class="value-display" id="registeredConversionDisplay">
                            1 registered unit = 1 base unit
                        </div>
                    </div>
                    
                    <!-- DISPLAY UNIT SECTION -->
                    <div class="form-group">
                        <label for="displayUnit">
                            <i class="fas fa-eye"></i> Display Unit *
                        </label>
                        <input list="displayUnitList" id="displayUnit" class="datalist-input" required placeholder="Type display unit (e.g., tablet, capsule)">
                        <datalist id="displayUnitList">
                            <option value="tablet">
                            <option value="capsule">
                            <option value="piece">
                            <option value="strip">
                            <option value="bottle">
                            <option value="pack">
                            <option value="sachet">
                            <option value="vial">
                            <option value="ampoule">
                        </datalist>
                    </div>
                    
                    <div class="form-group">
                        <label for="displayToBaseFactor">
                            <i class="fas fa-exchange-alt"></i> Display → Base Factor *
                        </label>
                        <input type="number" id="displayToBaseFactor" min="1" step="1" value="1" required placeholder="1 display unit = ? base units">
                        <div class="value-display" id="displayConversionDisplay">
                            1 display unit = 1 base unit
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="allowFractionalDisplay">
                            <i class="fas fa-divide"></i> Allow Fractional Display
                        </label>
                        <select id="allowFractionalDisplay">
                            <option value="false">No (Whole units only)</option>
                            <option value="true">Yes (Allow fractions)</option>
                        </select>
                        <div class="conversion-info">
                            Controls whether display quantities can show fractions
                        </div>
                    </div>
                    
                    <!-- INITIAL STOCK SECTION -->
                    <div class="form-group">
                        <label for="initialQuantityType">
                            <i class="fas fa-hashtag"></i> Initial Stock Entry *
                        </label>
                        <select id="initialQuantityType" required>
                            <option value="">Select quantity type...</option>
                            <option value="registered">Registered Units</option>
                            <option value="display">Display Units</option>
                            <option value="base">Base Units</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="initialQuantity">
                            <i class="fas fa-calculator"></i> Quantity *
                        </label>
                        <input type="number" id="initialQuantity" min="0" step="0.01" required placeholder="Enter quantity">
                        <div class="value-display" id="quantityConversionDisplay">
                            Enter quantity in selected units
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="baseQuantityDisplay">
                            <i class="fas fa-database"></i> Stored Quantity (Base Units)
                        </label>
                        <div class="value-display" id="baseQuantityDisplay" style="background: rgba(0, 255, 136, 0.1);">
                            0 base units
                        </div>
                    </div>
                    
                    <!-- PRICING SECTION -->
                    <div class="form-group">
                        <label for="purchasePricePerDisplay">
                            <i class="fas fa-tag"></i> Purchase Price per Display Unit (ETB) *
                        </label>
                        <input type="number" id="purchasePricePerDisplay" min="0" step="0.01" required placeholder="0.00">
                        <div class="conversion-info">
                            Price per display unit (shown to customers)
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="markup">
                            <i class="fas fa-percentage"></i> Markup Percentage *
                        </label>
                        <input type="number" id="markup" min="0" step="0.1" value="50.0" required>
                        <div class="value-display">
                            <button type="button" id="applyMarkup" style="background: var(--gold); color: var(--primary-blue); border: none; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer;">
                                Apply Markup
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="sellingPricePerDisplay">
                            <i class="fas fa-money-bill-wave"></i> Selling Price per Display Unit (ETB) *
                        </label>
                        <input type="number" id="sellingPricePerDisplay" min="0" step="0.01" required placeholder="0.00">
                        <div class="value-display" id="sellingPriceDisplay">
                            ETB 0.00 (50.0% markup)
                        </div>
                    </div>
                    
                    <!-- ADDITIONAL INFORMATION -->
                    <div class="form-group">
                        <label for="batchNumber">
                            <i class="fas fa-barcode"></i> Batch Number *
                        </label>
                        <input type="text" id="batchNumber" required placeholder="Batch number">
                    </div>
                    
                    <div class="form-group">
                        <label for="expiryDate">
                            <i class="fas fa-calendar-alt"></i> Expiry Date *
                        </label>
                        <input type="date" id="expiryDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="supplier">
                            <i class="fas fa-truck"></i> Supplier *
                        </label>
                        <input type="text" id="supplier" required placeholder="Supplier/Manufacturer name">
                    </div>
                    
                    <div class="form-group">
                        <label for="registrant">
                            <i class="fas fa-user-check"></i> Registrant *
                        </label>
                        <input type="text" id="registrant" required placeholder="Name of person registering">
                    </div>
                    
                    <div class="form-group">
                        <label for="branch">
                            <i class="fas fa-store"></i> Branch *
                        </label>
                        <select id="branch" required>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="storageLocation">
                            <i class="fas fa-map-marker-alt"></i> Storage Location (Optional)
                        </label>
                        <input type="text" id="storageLocation" placeholder="e.g., Shelf A1, Refrigerator 2">
                    </div>
                    
                    <div class="form-group">
                        <label for="minStockBase">
                            <i class="fas fa-arrow-down"></i> Minimum Stock Level (Base Units) *
                        </label>
                        <input type="number" id="minStockBase" min="0" value="10" required>
                        <div class="conversion-info">
                            Alert when stock falls below this base unit quantity
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="maxStockBase">
                            <i class="fas fa-arrow-up"></i> Maximum Stock Level (Base Units) *
                        </label>
                        <input type="number" id="maxStockBase" min="0" value="100" required>
                        <div class="conversion-info">
                            Alert when stock exceeds this base unit quantity
                        </div>
                    </div>
                    
                    <!-- MIXED UNIT DISPLAY -->
                    <div class="form-group full-width">
                        <label for="mixedUnitDisplay">
                            <i class="fas fa-layer-group"></i> Mixed Unit Display
                        </label>
                        <div class="mixed-unit-display" id="mixedUnitDisplay">
                            No units registered yet
                        </div>
                        <div class="conversion-info">
                            Shows stock in registered + display + remaining base units format
                        </div>
                    </div>
                    
                    <!-- TOTAL VALUE -->
                    <div class="form-group full-width">
                        <label for="totalValueCalc">
                            <i class="fas fa-calculator"></i> Total Value
                        </label>
                        <div class="value-display" id="totalValueCalc" style="background: rgba(255, 215, 0, 0.1);">
                            ETB 0.00 (0 base units)
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i> Save Item
                    </button>
                    <button type="button" class="btn btn-secondary" id="clearForm">
                        <i class="fas fa-times"></i> Clear Form
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sales Page -->
    <div class="full-screen-mode" id="salesPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-shopping-cart"></i> Sales Transaction</h2>
            <button class="close-full-screen" id="closeSales">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <form id="salesForm">
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="sales-search-item" id="searchSalesItem" placeholder="Search items for sale...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="salesDate">
                            <i class="fas fa-calendar"></i> Date *
                        </label>
                        <input type="date" id="salesDate" required>
                    </div>
                    <div class="form-group">
                        <label for="salesBranch">
                            <i class="fas fa-store"></i> Branch *
                        </label>
                        <select id="salesBranch" required>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="salesPaymentMethod">
                            <i class="fas fa-credit-card"></i> Payment Mode *
                        </label>
                        <select id="salesPaymentMethod" required>
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="mobile">Mobile Money</option>
                            <option value="credit">Credit</option>
                            <option value="insurance">Insurance</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="salesperson">
                            <i class="fas fa-user-md"></i> Salesperson *
                        </label>
                        <input type="text" id="salesperson" required placeholder="Salesperson name">
                    </div>
                    <div class="form-group">
                        <label for="salesApprover">
                            <i class="fas fa-user-shield"></i> Approved By
                        </label>
                        <input type="text" id="salesApprover" placeholder="Optional">
                    </div>
                </div>

                <div style="margin: 1.5rem 0;">
                    <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-list"></i> Sales Items
                        <button type="button" id="addSalesRow" style="margin-left: auto; background: var(--gold); color: var(--primary-blue); border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Add Row
                        </button>
                    </h3>
                    
                    <div class="sales-table-container">
                        <table class="sales-table" id="salesItemsTable">
                            <thead>
                                <tr>
                                    <th>Item / Drug Name</th>
                                    <th>Batch No</th>
                                    <th>Base Unit</th>
                                    <th>Display Unit</th>
                                    <th>Quantity (Display)</th>
                                    <th>Quantity (Base)</th>
                                    <th>Unit Price (ETB)</th>
                                    <th>Discount (ETB)</th>
                                    <th>VAT %</th>
                                    <th>Total Price (ETB)</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="salesItemsBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="sales-summary" style="background: rgba(255, 215, 0, 0.05); border-radius: 10px; padding: 1rem; margin-top: 1rem; border: 1px solid rgba(255, 215, 0, 0.2);">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Subtotal:</label>
                            <div class="value-display" id="salesSubtotal">ETB 0.00</div>
                        </div>
                        <div class="form-group">
                            <label>Total Discount:</label>
                            <div class="value-display" id="salesTotalDiscount">ETB 0.00</div>
                        </div>
                        <div class="form-group">
                            <label>Total VAT:</label>
                            <div class="value-display" id="salesTotalVAT">ETB 0.00</div>
                        </div>
                        <div class="form-group">
                            <label><strong>Grand Total:</strong></label>
                            <div class="value-display" style="background: rgba(255, 215, 0, 0.2); font-weight: bold;" id="salesGrandTotal">ETB 0.00</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cost of Goods:</label>
                            <div class="value-display" id="salesCOGS">ETB 0.00</div>
                        </div>
                        <div class="form-group">
                            <label>Gross Profit:</label>
                            <div class="value-display" id="salesGrossProfit">ETB 0.00</div>
                        </div>
                        <div class="form-group">
                            <label>Profit Margin:</label>
                            <div class="value-display" id="salesProfitMargin">0%</div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Save Transaction
                    </button>
                    <button type="button" class="btn btn-secondary" id="clearSalesForm">
                        <i class="fas fa-times"></i> Clear Form
                    </button>
                    <button type="button" class="btn btn-secondary" id="newSalesForm">
                        <i class="fas fa-plus"></i> New Sale
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stock Inventory Page -->
    <div class="full-screen-mode" id="stockInventoryPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-list-alt"></i> Inventory</h2>
            <button class="close-full-screen" id="closeStockInventory">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="search-filter">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search items...">
            </div>
            <div class="filter-select">
                <select id="categoryFilter">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="filter-select">
                <select id="branchFilter">
                    <option value="">All Branches</option>
                    <option value="merkeb">Merkeb Jabo House</option>
                    <option value="no1">Bete‑Saida No.1</option>
                    <option value="no2">Bete‑Saida No.2</option>
                </select>
            </div>
            <div class="filter-select">
                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="low">Low Stock</option>
                    <option value="over">Overstock</option>
                    <option value="expiry">Near Expiry</option>
                    <option value="expired">Expired</option>
                    <option value="stockout">Stock Out</option>
                    <option value="negative">Negative Profit</option>
                </select>
            </div>
            <button class="btn btn-secondary" id="clearFilters">
                <i class="fas fa-filter-circle-xmark"></i> Clear
            </button>
        </div>
        
        <div class="table-container">
            <table id="stockTable">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Category</th>
                        <th>Base Unit</th>
                        <th>Registered Unit</th>
                        <th>Reg → Base</th>
                        <th>Display Unit</th>
                        <th>Disp → Base</th>
                        <th>Qty (Base)</th>
                        <th>Qty (Display)</th>
                        <th>Mixed Unit View</th>
                        <th>Min/Max (Base)</th>
                        <th>Purchase/Display</th>
                        <th>Selling/Display</th>
                        <th>Margin %</th>
                        <th>Total Value</th>
                        <th>Batch No.</th>
                        <th>Branch</th>
                        <th>Expiry Date</th>
                        <th>Fractional Allowed</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="stockTableBody">
                </tbody>
            </table>
        </div>
        
        <div class="no-data" id="noData" style="text-align: center; padding: 2rem 1rem; color: var(--gray); display: none;">
            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <h3>No Stock Items Found</h3>
            <p>Start by adding your first medicine using the Register Stock Item form.</p>
            <button class="btn btn-primary" id="addFirstItem" style="margin-top: 1rem;">
                <i class="fas fa-plus"></i> Register First Item
            </button>
        </div>
    </div>

    <!-- Add Stock Page -->
    <div class="full-screen-mode" id="addStockPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-arrow-down"></i> Add Stock</h2>
            <button class="close-full-screen" id="closeAddStock">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <form id="addStockForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="addItemSelect"><i class="fas fa-box"></i> Select Item *</label>
                        <select id="addItemSelect" required>
                            <option value="">Choose an item...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="addBaseUnit"><i class="fas fa-balance-scale"></i> Base Unit *</label>
                        <input type="text" id="addBaseUnit" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="addRegisteredUnit"><i class="fas fa-box"></i> Registered Unit *</label>
                        <input type="text" id="addRegisteredUnit" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="addRegisteredToBaseFactor"><i class="fas fa-exchange-alt"></i> Registered → Base Factor *</label>
                        <input type="number" id="addRegisteredToBaseFactor" min="1" step="1" readonly style="background: rgba(255, 255, 255, 0.1);">
                        <div class="value-display" id="addRegisteredConversionDisplay">1 registered = 1 base</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="addDisplayUnit"><i class="fas fa-eye"></i> Display Unit *</label>
                        <input type="text" id="addDisplayUnit" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="addDisplayToBaseFactor"><i class="fas fa-exchange-alt"></i> Display → Base Factor *</label>
                        <input type="number" id="addDisplayToBaseFactor" min="1" step="1" readonly style="background: rgba(255, 255, 255, 0.1);">
                        <div class="value-display" id="addDisplayConversionDisplay">1 display = 1 base</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="addAllowFractional"><i class="fas fa-divide"></i> Fractional Display Allowed</label>
                        <input type="text" id="addAllowFractional" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="addQuantityType"><i class="fas fa-hashtag"></i> Quantity Entry Type *</label>
                        <select id="addQuantityType" required>
                            <option value="">Select type...</option>
                            <option value="registered">Registered Units</option>
                            <option value="display">Display Units</option>
                            <option value="base">Base Units</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="addQuantity"><i class="fas fa-calculator"></i> Quantity to Add *</label>
                        <input type="number" id="addQuantity" min="0.01" step="0.01" required placeholder="Enter quantity">
                        <div class="value-display" id="addQuantityDisplay">0 base units</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="addUnitPrice"><i class="fas fa-tag"></i> Purchase Price per Display Unit (ETB) *</label>
                        <input type="number" id="addUnitPrice" min="0" step="0.01" required placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="addMarkup">
                            <i class="fas fa-percentage"></i> Markup Percentage *
                        </label>
                        <input type="number" id="addMarkup" min="0" step="0.1" value="50.0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="addSellingPrice"><i class="fas fa-money-bill-wave"></i> Selling Price per Display Unit (ETB) *</label>
                        <input type="number" id="addSellingPrice" min="0" step="0.01" required placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="addBranch"><i class="fas fa-store"></i> Branch *</label>
                        <select id="addBranch" required>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="addReason"><i class="fas fa-clipboard-list"></i> Reason *</label>
                        <select id="addReason" required>
                            <option value="restock">Restock</option>
                            <option value="new_batch">New Batch</option>
                            <option value="transfer_in">Transfer In</option>
                            <option value="return">Customer Return</option>
                            <option value="donation">Donation Received</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="addBatchNumber"><i class="fas fa-barcode"></i> Batch Number</label>
                        <input type="text" id="addBatchNumber" placeholder="Enter batch number">
                    </div>
                    
                    <div class="form-group">
                        <label for="addExpiryDate"><i class="fas fa-calendar-alt"></i> Expiry Date</label>
                        <input type="date" id="addExpiryDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="addSupplier"><i class="fas fa-truck"></i> Supplier</label>
                        <input type="text" id="addSupplier" placeholder="Supplier name">
                    </div>
                    
                    <div class="form-group">
                        <label for="addStorageLocation"><i class="fas fa-map-marker-alt"></i> Storage Location</label>
                        <input type="text" id="addStorageLocation" placeholder="Optional">
                    </div>
                    
                    <div class="form-group">
                        <label for="addApprovedBy"><i class="fas fa-user-check"></i> Approved By</label>
                        <input type="text" id="addApprovedBy" placeholder="Optional">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="addNotes"><i class="fas fa-sticky-note"></i> Notes</label>
                        <textarea id="addNotes" rows="2" placeholder="Additional details..."></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Add Stock
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelAdd">
                        Clear Form
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Deduct Stock Page -->
    <div class="full-screen-mode" id="deductStockPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-arrow-up"></i> Deduct Stock</h2>
            <button class="close-full-screen" id="closeDeductStock">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <div class="search-filter">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchDeductItem" placeholder="Search items to deduct...">
                </div>
            </div>
            
            <form id="reduceStockForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="reduceItemSelect"><i class="fas fa-box"></i> Select Item *</label>
                        <select id="reduceItemSelect" required>
                            <option value="">Choose an item...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceBaseUnit"><i class="fas fa-balance-scale"></i> Base Unit *</label>
                        <input type="text" id="reduceBaseUnit" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceDisplayUnit"><i class="fas fa-eye"></i> Display Unit *</label>
                        <input type="text" id="reduceDisplayUnit" readonly style="background: rgba(255, 255, 255, 0.1);">
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceDisplayToBaseFactor"><i class="fas fa-exchange-alt"></i> Display → Base Factor *</label>
                        <input type="number" id="reduceDisplayToBaseFactor" min="1" step="1" readonly style="background: rgba(255, 255, 255, 0.1);">
                        <div class="value-display" id="reduceConversionDisplay">1 display unit = 1 base unit</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceBranch"><i class="fas fa-store"></i> Branch *</label>
                        <select id="reduceBranch" required>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceQuantity"><i class="fas fa-calculator"></i> Quantity to Deduct (Display Units) *</label>
                        <input type="number" id="reduceQuantity" min="0.01" step="0.01" required placeholder="Enter quantity">
                        <div class="value-display" id="reduceBaseQuantity">0 base units</div>
                        <small style="color: var(--gray); display: block; margin-top: 5px;">
                            Available: <span id="availableDisplayQuantity">0</span> display units (<span id="availableBaseQuantity">0</span> base units)
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="reduceReason"><i class="fas fa-clipboard-list"></i> Reason *</label>
                        <select id="reduceReason" required>
                            <option value="sale">Sale</option>
                            <option value="damaged">Damaged</option>
                            <option value="expired">Expired</option>
                            <option value="internal">Internal Use</option>
                            <option value="donation">Donation</option>
                            <option value="return">Supplier Return</option>
                            <option value="transfer_out">Transfer Out</option>
                            <option value="theft">Theft/Shrinkage</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="whom">
                            <i class="fas fa-user-check"></i> Whom (Responsible Person) *
                        </label>
                        <input type="text" id="whom" required placeholder="Name of person taking items">
                    </div>
                    
                    <div class="form-group">
                        <label for="approver">
                            <i class="fas fa-user-shield"></i> Approved By (Optional)
                        </label>
                        <input type="text" id="approver" placeholder="Supervisor/Manager name">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="reduceNotes"><i class="fas fa-sticky-note"></i> Notes</label>
                        <textarea id="reduceNotes" rows="2" placeholder="Additional details..."></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Deduct Stock
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelReduce">
                        Clear Form
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Review Dashboard Page -->
    <div class="full-screen-mode" id="reviewPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-chart-bar"></i> Review Dashboard</h2>
            <button class="close-full-screen" id="closeReview">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="search-filter">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="reviewSearch" placeholder="Search dashboard items...">
            </div>
            <div class="filter-select">
                <select id="reviewCategoryFilter">
                    <option value="all">All Categories</option>
                    <option value="expired">Expired</option>
                    <option value="stockout">Stock Out</option>
                    <option value="lowstock">Low Stock</option>
                    <option value="overstock">Overstock</option>
                    <option value="nearexpiry">Near Expiry</option>
                    <option value="negativeprofit">Negative Profit</option>
                </select>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card clickable" data-page="stockInventoryPage">
                <h3><i class="fas fa-boxes"></i> Total Stock Items</h3>
                <div class="value" id="totalStockItems">0</div>
                <div class="sub-value">Active inventory items</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="addStockPage">
                <h3><i class="fas fa-arrow-down"></i> Total Incoming Stock</h3>
                <div class="value" id="totalIncoming">0</div>
                <div class="sub-value">This month</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="deductStockPage">
                <h3><i class="fas fa-arrow-up"></i> Total Outgoing Stock</h3>
                <div class="value" id="totalOutgoing">0</div>
                <div class="sub-value">This month</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="salesPage">
                <h3><i class="fas fa-shopping-cart"></i> Total Sales</h3>
                <div class="value" id="totalSales">ETB 0</div>
                <div class="sub-value">This month</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="stockInventoryPage" data-filter="low">
                <h3><i class="fas fa-exclamation-triangle"></i> Low Stock Items</h3>
                <div class="value" id="lowStockItems">0</div>
                <div class="sub-value">Items below threshold</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="stockInventoryPage" data-filter="expiry">
                <h3><i class="fas fa-calendar-times"></i> Near Expiry</h3>
                <div class="value" id="nearExpiryItems">0</div>
                <div class="sub-value">Expiring in 60 days</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="stockInventoryPage" data-filter="expired">
                <h3><i class="fas fa-times-circle"></i> Expired Items</h3>
                <div class="value" id="expiredItems">0</div>
                <div class="sub-value">Already expired</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="stockInventoryPage">
                <h3><i class="fas fa-money-bill-wave"></i> Total Inventory Value</h3>
                <div class="value" id="totalInventoryValue">ETB 0</div>
                <div class="sub-value">Current stock value</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="salesPage">
                <h3><i class="fas fa-chart-line"></i> Today's Sales</h3>
                <div class="value" id="todaySales">ETB 0</div>
                <div class="sub-value">Revenue today</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="salesPage">
                <h3><i class="fas fa-coins"></i> Today's Profit</h3>
                <div class="value" id="todayProfit">ETB 0</div>
                <div class="sub-value">Profit today</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="stockInventoryPage" data-filter="stockout">
                <h3><i class="fas fa-exclamation-circle"></i> Stock Out Items</h3>
                <div class="value" id="stockoutItems">0</div>
                <div class="sub-value">Items with zero quantity</div>
            </div>
            
            <div class="dashboard-card clickable" data-page="auditPage">
                <h3><i class="fas fa-skull-crossbones"></i> Loss This Month</h3>
                <div class="value" id="monthLoss">ETB 0</div>
                <div class="sub-value">From damages & expiry</div>
            </div>
        </div>
        
        <div style="margin: 1.5rem 0; background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 10px;">
            <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-filter"></i> Filter by Medicine Category
            </h3>
            <select id="chartCategoryFilter" style="width: 100%; padding: 0.7rem; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 215, 0, 0.2); border-radius: 8px; color: var(--light);">
                <option value="all">All Categories</option>
            </select>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-pie"></i> Stock Distribution by Branch</h3>
                <canvas id="branchChart" height="200"></canvas>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-bar"></i> Stock by Category</h3>
                <canvas id="categoryChart" height="200"></canvas>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-line"></i> Monthly Sales Trend</h3>
                <canvas id="salesTrendChart" height="200"></canvas>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-area"></i> Inventory Value Distribution</h3>
                <canvas id="valueChart" height="200"></canvas>
            </div>
        </div>
        
        <div style="margin-top: 1.5rem;">
            <div class="dashboard-card">
                <h3><i class="fas fa-star"></i> Top Selling Items (Last 30 Days)</h3>
                <div class="table-container" style="max-height: 300px;">
                    <table style="min-width: auto;">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Quantity Sold</th>
                                <th>Revenue (ETB)</th>
                                <th>Profit (ETB)</th>
                                <th>Margin %</th>
                                <th>Branch</th>
                            </tr>
                        </thead>
                        <tbody id="topItemsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 1.5rem;">
            <div class="dashboard-card">
                <h3><i class="fas fa-exclamation-triangle"></i> Risk Items (Require Attention)</h3>
                <div class="table-container" style="max-height: 300px;">
                    <table style="min-width: auto;">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Issue</th>
                                <th>Current</th>
                                <th>Threshold</th>
                                <th>Expiry Date</th>
                                <th>Branch</th>
                                <th>Action Needed</th>
                            </tr>
                        </thead>
                        <tbody id="riskItemsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Trail Page -->
    <div class="full-screen-mode" id="auditPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-shield-alt"></i> Audit Trail & Security</h2>
            <button class="close-full-screen" id="closeAudit">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <div class="search-filter">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchAudit" placeholder="Search audit records...">
                </div>
                <div class="filter-select">
                    <select id="auditTypeFilter">
                        <option value="">All Audit Types</option>
                        <option value="beginning_balance">Beginning Balance</option>
                        <option value="purchase">Purchases / Inflow</option>
                        <option value="sale">Sales / Outflow</option>
                        <option value="sale_return">Sales Returns</option>
                        <option value="purchase_return">Purchase Returns</option>
                        <option value="expired">Expired Stock</option>
                        <option value="damaged">Damaged / Lost Stock</option>
                        <option value="adjustment">Stock Adjustments</option>
                        <option value="cogs">Cost of Goods Sold</option>
                        <option value="profit">Gross Profit</option>
                        <option value="net_profit">Net Profit</option>
                        <option value="discount">Discounts</option>
                        <option value="variance">Stock Variance</option>
                        <option value="physical_count">Physical Count</option>
                        <option value="system_count">System Count</option>
                        <option value="negative_stock">Negative Stock</option>
                        <option value="overstock">Overstock</option>
                        <option value="reorder">Reorder Level</option>
                        <option value="ending_balance">Ending Balance</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-circle"></i> Current Alerts & Anomalies
                </h3>
                
                <div id="auditAlerts" style="margin-bottom: 1.5rem;">
                    <!-- Alerts will be populated here -->
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-line"></i> Financial Audit Summary
                </h3>
                
                <div class="audit-summary-grid">
                    <div class="audit-summary-item page-link" data-page="auditPage">
                        <h4>Beginning Balance</h4>
                        <div class="audit-summary-value" id="auditBeginningBalance">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="addStockPage">
                        <h4>Purchases / Inflow</h4>
                        <div class="audit-summary-value" id="auditPurchases">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="salesPage">
                        <h4>Sales / Outflow</h4>
                        <div class="audit-summary-value" id="auditSales">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="deductStockPage">
                        <h4>Sales Returns</h4>
                        <div class="audit-summary-value" id="auditSalesReturns">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="deductStockPage">
                        <h4>Purchase Returns</h4>
                        <div class="audit-summary-value" id="auditPurchaseReturns">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="stockInventoryPage" data-filter="expired">
                        <h4>Expired Stock</h4>
                        <div class="audit-summary-value" id="auditExpiredStock">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="stockInventoryPage">
                        <h4>Damaged / Lost Stock</h4>
                        <div class="audit-summary-value" id="auditDamagedStock">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="auditPage">
                        <h4>Stock Adjustments</h4>
                        <div class="audit-summary-value" id="auditAdjustments">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="salesPage">
                        <h4>Cost of Goods Sold (COGS)</h4>
                        <div class="audit-summary-value" id="auditCOGS">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="salesPage">
                        <h4>Gross Profit</h4>
                        <div class="audit-summary-value" id="auditGrossProfit">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="reportsPage">
                        <h4>Net Profit</h4>
                        <div class="audit-summary-value" id="auditNetProfit">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="salesPage">
                        <h4>Discounts Given</h4>
                        <div class="audit-summary-value" id="auditDiscounts">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="auditPage">
                        <h4>Stock Variance</h4>
                        <div class="audit-summary-value" id="auditVariance">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="reportsPage">
                        <h4>Physical Count Value</h4>
                        <div class="audit-summary-value" id="auditPhysicalCount">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="reportsPage">
                        <h4>System Count Value</h4>
                        <div class="audit-summary-value" id="auditSystemCount">ETB 0.00</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="stockInventoryPage" data-filter="negative">
                        <h4>Negative Stock Items</h4>
                        <div class="audit-summary-value" id="auditNegativeStock">0 items</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="stockInventoryPage" data-filter="over">
                        <h4>Overstock Items</h4>
                        <div class="audit-summary-value" id="auditOverstock">0 items</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="stockInventoryPage" data-filter="low">
                        <h4>Items at Reorder Level</h4>
                        <div class="audit-summary-value" id="auditReorderLevel">0 items</div>
                    </div>
                    
                    <div class="audit-summary-item page-link" data-page="reportsPage">
                        <h4>Ending Balance</h4>
                        <div class="audit-summary-value" id="auditEndingBalance">ETB 0.00</div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 215, 0, 0.05); border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.2);">
                    <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Audit Status</h4>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="flex: 1;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Approval Status</div>
                            <div style="color: var(--light); font-size: 1.1rem; font-weight: bold;" id="auditApprovalStatus">Pending Review</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Last Audit Date</div>
                            <div style="color: var(--light); font-size: 1.1rem; font-weight: bold;" id="auditLastDate">Never</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Auditor</div>
                            <div style="color: var(--light); font-size: 1.1rem; font-weight: bold;" id="auditAuditor">Not Assigned</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div>
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-search"></i> Audit Trail Filters
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">Start Date</label>
                        <input type="date" id="auditStartDate" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">End Date</label>
                        <input type="date" id="auditEndDate" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">User/Responsible</label>
                        <input type="text" id="auditUser" placeholder="Filter by user" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">Branch</label>
                        <select id="auditBranch" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                            <option value="">All Branches</option>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="runAuditReport" style="width: 100%;">
                    <i class="fas fa-search"></i> Run Audit Report
                </button>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-file-alt"></i> Audit Trail Log
                </h3>
                
                <div class="table-container">
                    <table id="auditTable">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Audit Type</th>
                                <th>Item</th>
                                <th>User</th>
                                <th>Quantity (Base)</th>
                                <th>Value (ETB)</th>
                                <th>Branch</th>
                                <th>Details</th>
                                <th>Approval Status</th>
                            </tr>
                        </thead>
                        <tbody id="auditTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports & Export Page -->
    <div class="full-screen-mode" id="reportsPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-file-export"></i> Reports</h2>
            <button class="close-full-screen" id="closeReports">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <div class="search-filter">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchReports" placeholder="Search reports...">
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-file-alt"></i> Generate Reports
                </h3>
                
                <div class="dashboard-grid">
                    <div class="data-management-card page-link" data-page="stockInventoryPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Comprehensive Stock Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Detailed stock report with all data</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="stock" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="stock" style="flex: 1;">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="salesPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Sales Transaction Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">All sales transactions with details</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="sales" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="sales" style="flex: 1;">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="dataManagementPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Export All Data to Excel</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Export complete database</p>
                        <button class="btn btn-secondary" id="exportToExcel" style="width: 100%; padding: 0.5rem;">
                            <i class="fas fa-file-excel"></i> Export Excel
                        </button>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="stockInventoryPage" data-filter="low">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Low Stock & Expiry Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Critical items needing attention</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="lowstock" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="lowstock" style="flex: 1;">
                                <i class="fas fa-exclamation-triangle"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="reviewPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Category Analysis Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Performance by medicine category</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="category" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="category" style="flex: 1;">
                                <i class="fas fa-chart-pie"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="reportsPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Financial Summary Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Revenue, profit & expenses</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="financial" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="financial" style="flex: 1;">
                                <i class="fas fa-money-bill-wave"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="auditPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Audit Trail Report</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Complete security audit log</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="audit" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="audit" style="flex: 1;">
                                <i class="fas fa-shield-alt"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="reportsPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Profit & Loss Statement</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Monthly P&L with COGS</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-view view-report" data-report="profitloss" style="flex: 1;">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-secondary generate-report" data-report="profitloss" style="flex: 1;">
                                <i class="fas fa-chart-line"></i> PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-filter"></i> Report Filters
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">Start Date</label>
                        <input type="date" id="reportStartDate" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">End Date</label>
                        <input type="date" id="reportEndDate" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">Branch</label>
                        <select id="reportBranch" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                            <option value="">All Branches</option>
                            <option value="merkeb">Merkeb Jabo House</option>
                            <option value="no1">Bete‑Saida No.1</option>
                            <option value="no2">Bete‑Saida No.2</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="color: var(--gray); font-size: 0.9rem;">Category</label>
                        <select id="reportCategory" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Management Page -->
    <div class="full-screen-mode" id="dataManagementPage">
        <div class="full-screen-header">
            <h2><i class="fas fa-database"></i> Data Management</h2>
            <button class="close-full-screen" id="closeDataManagement">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="form-container">
            <div class="search-filter">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchDataManagement" placeholder="Search data management...">
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-line"></i> System Statistics
                </h3>
                
                <div class="dashboard-grid">
                    <div class="data-management-card page-link" data-page="stockInventoryPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Total Registered Items</h4>
                        <div style="font-size: 1.5rem; color: var(--light); text-align: center;" id="statTotalItems">0</div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="salesPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Total Sales Transactions</h4>
                        <div style="font-size: 1.5rem; color: var(--light); text-align: center;" id="statTotalSales">0</div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="auditPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Total Stock Movements</h4>
                        <div style="font-size: 1.5rem; color: var(--light); text-align: center;" id="statTotalMovements">0</div>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="reportsPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Data Last Updated</h4>
                        <div style="font-size: 1rem; color: var(--light); text-align: center;" id="statLastUpdated">Never</div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-cogs"></i> System Settings
                </h3>
                
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 1rem; border: 1px solid rgba(255, 215, 0, 0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Low Stock Threshold (%)</label>
                            <input type="number" id="lowStockThreshold" value="20" min="1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                        
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Expiry Warning Days</label>
                            <input type="number" id="expiryWarningDays" value="60" min="1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                        
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Default Markup %</label>
                            <input type="number" id="defaultMarkup" value="50.0" min="0" step="0.1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                        
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Overstock Alert %</label>
                            <input type="number" id="overstockAlert" value="150" min="100" step="1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                        
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Profit Margin Alert %</label>
                            <input type="number" id="profitMarginAlert" value="10" min="0" step="1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                        
                        <div>
                            <label style="color: var(--gray); font-size: 0.9rem;">Default VAT %</label>
                            <input type="number" id="defaultVAT" value="15" min="0" step="0.1" style="width: 100%; padding: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 5px; color: var(--light);">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: var(--gray); font-size: 0.9rem; display: block; margin-bottom: 0.5rem;">Notification Settings</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="notifyLowStock" checked>
                                Low Stock Alerts
                            </label>
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="notifyExpiry" checked>
                                Expiry Alerts
                            </label>
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="notifyOverstock" checked>
                                Overstock Alerts
                            </label>
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="notifyNegativeProfit" checked>
                                Negative Profit Alerts
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="color: var(--gray); font-size: 0.9rem; display: block; margin-bottom: 0.5rem;">Automatic Calculations</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="autoCostCalc" checked>
                                Auto Cost Calculation
                            </label>
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="autoProfitCalc" checked>
                                Auto Profit Calculation
                            </label>
                            <label style="color: var(--light); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="autoMarginCalc" checked>
                                Auto Margin Calculation
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveSettings" style="width: 100%;">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--gold); margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-save"></i> Backup & Restore
                </h3>
                
                <div class="dashboard-grid">
                    <div class="data-management-card page-link" data-page="reportsPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Backup All Data</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Create backup of complete database</p>
                        <button class="btn btn-primary" id="backupData" style="width: 100%; padding: 0.5rem;">
                            <i class="fas fa-save"></i> Backup Now
                        </button>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="dataManagementPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Restore Data</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Restore from backup file</p>
                        <button class="btn btn-secondary" id="restoreData" style="width: 100%; padding: 0.5rem;">
                            <i class="fas fa-upload"></i> Restore Data
                        </button>
                    </div>
                    
                    <div class="data-management-card page-link" data-page="reportsPage">
                        <h4 style="color: var(--gold); margin-bottom: 0.5rem;">Export Database</h4>
                        <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 1rem;">Export for external analysis</p>
                        <button class="btn btn-secondary" id="exportDatabase" style="width: 100%; padding: 0.5rem;">
                            <i class="fas fa-database"></i> Export SQL
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem; text-align: center;">
                <button class="btn btn-secondary" id="clearAllData" style="background: rgba(255, 68, 68, 0.1); color: var(--danger); border-color: rgba(255, 68, 68, 0.3);">
                    <i class="fas fa-trash-alt"></i> Clear All Data
                </button>
            </div>
        </div>
    </div>

    <!-- Guideline Modal -->
    <div class="guideline-modal" id="guidelineModal">
        <div class="guideline-header">
            <h2><i class="fas fa-book"></i> Pharmacy Guidelines</h2>
            <button class="close-guideline" id="closeGuideline">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="guideline-content">
            <div class="guideline-section">
                <h3><i class="fas fa-door-open"></i> Introduction (መግቢያ)</h3>
                <p>This comprehensive guideline document provides standard operating procedures for the efficient management of pharmaceutical stock at Bete-Saida Pharmacy. It aims to ensure the availability of quality medicines, minimize losses, and optimize inventory control.</p>
            </div>
            
            <div class="guideline-section">
                <h3><i class="fas fa-capsules"></i> Stock Registration Guidelines</h3>
                <p>All pharmaceutical items must be registered in the system before being made available for sale. Follow these steps:</p>
                <ul class="guideline-list">
                    <li>Verify the medicine's authenticity and expiration date</li>
                    <li>Record batch number, manufacturer, and supplier details</li>
                    <li>Set appropriate minimum and maximum stock levels</li>
                    <li>Apply correct markup percentage based on category</li>
                </ul>
            </div>
            
            <div class="guideline-section">
                <h3><i class="fas fa-shopping-cart"></i> Sales Procedures</h3>
                <p>Ensure proper documentation and stock deduction during sales:</p>
                <ul class="guideline-list">
                    <li>Always verify customer prescriptions when required</li>
                    <li>Check expiration dates before dispensing</li>
                    <li>Record salesperson and payment method details</li>
                    <li>Apply discounts only with proper authorization</li>
                </ul>
            </div>
            
            <div class="guideline-section">
                <h3><i class="fas fa-exclamation-triangle"></i> Quality Control</h3>
                <p>Maintain high standards of pharmaceutical quality:</p>
                <ul class="guideline-list">
                    <li>Regularly check for expired or damaged stock</li>
                    <li>Maintain proper storage conditions</li>
                    <li>Monitor temperature-sensitive medications</li>
                    <li>Report any quality issues immediately</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div class="report-preview-modal" id="reportPreviewModal">
        <div class="report-preview-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 215, 0, 0.2);">
                <h2 style="color: var(--gold);">Report Preview</h2>
                <button onclick="document.getElementById('reportPreviewModal').classList.remove('active')" style="background: none; border: none; color: var(--gold); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="reportPreviewContent" style="height: calc(100vh - 100px); overflow: auto;"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        class PharmacyManagementSystem {
            constructor() {
                this.supabase = null;
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.isConnected = false;
                this.isAuthenticated = false;
                this.userType = null;
                this.userName = null;
                this.settings = {
                    lowStockThreshold: 20,
                    expiryWarningDays: 60,
                    defaultMarkup: 50.0,
                    defaultVAT: 15.0,
                    overstockAlert: 150,
                    profitMarginAlert: 10
                };
                this.cache = {
                    stockItems: [],
                    categories: [],
                    sales: [],
                    transactions: [],
                    audit: []
                };
                this.init();
            }
            
            async init() {
                this.createParticles();
                this.setupEventListeners();
                await this.initSupabase();
                await this.loadSettings();
                this.setupWebSocket();
                
                document.getElementById('loading').style.display = 'none';
            }
            
            createParticles() {
                const particlesContainer = document.getElementById('particles');
                for (let i = 0; i < 10; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.width = Math.random() * 2 + 1 + 'px';
                    particle.style.height = particle.style.width;
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    particle.style.animationDuration = Math.random() * 15 + 5 + 's';
                    particlesContainer.appendChild(particle);
                }
            }
            
            async initSupabase() {
                // Replace with your Supabase credentials
                const supabaseUrl = 'https://your-project.supabase.co';
                const supabaseKey = 'your-anon-key';
                
                this.supabase = supabase.createClient(supabaseUrl, supabaseKey);
                
                try {
                    const { data, error } = await this.supabase
                        .from('system_settings')
                        .select('*')
                        .limit(1);
                    
                    if (!error && data.length > 0) {
                        this.settings = data[0];
                    }
                } catch (error) {
                    console.log('Using default settings');
                }
            }
            
            async loadSettings() {
                try {
                    const { data, error } = await this.supabase
                        .from('system_settings')
                        .select('*')
                        .limit(1);
                    
                    if (!error && data.length > 0) {
                        this.settings = data[0];
                        this.updateSettingsUI();
                    }
                } catch (error) {
                    console.log('Error loading settings:', error);
                }
            }
            
            updateSettingsUI() {
                if (document.getElementById('lowStockThreshold')) {
                    document.getElementById('lowStockThreshold').value = this.settings.lowStockThreshold;
                    document.getElementById('expiryWarningDays').value = this.settings.expiryWarningDays;
                    document.getElementById('defaultMarkup').value = this.settings.defaultMarkup;
                    document.getElementById('defaultVAT').value = this.settings.defaultVAT;
                    document.getElementById('overstockAlert').value = this.settings.overstockAlert;
                    document.getElementById('profitMarginAlert').value = this.settings.profitMarginAlert;
                }
            }
            
            setupWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws`;
                
                this.ws = new WebSocket(wsUrl);
                
                this.ws.onopen = () => {
                    console.log('WebSocket connected');
                    this.isConnected = true;
                    this.reconnectAttempts = 0;
                    this.updateConnectionStatus('online', 'Connected');
                    this.showRealtimeNotification('Real-time updates enabled');
                    
                    // Send authentication if logged in
                    if (this.isAuthenticated) {
                        this.ws.send(JSON.stringify({
                            type: 'auth',
                            userType: this.userType,
                            userName: this.userName
                        }));
                    }
                };
                
                this.ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.handleWebSocketMessage(data);
                };
                
                this.ws.onclose = () => {
                    console.log('WebSocket disconnected');
                    this.isConnected = false;
                    this.updateConnectionStatus('offline', 'Disconnected');
                    
                    // Attempt reconnection
                    if (this.reconnectAttempts < this.maxReconnectAttempts) {
                        this.reconnectAttempts++;
                        setTimeout(() => {
                            console.log(`Attempting reconnect ${this.reconnectAttempts}`);
                            this.setupWebSocket();
                        }, 3000 * this.reconnectAttempts);
                    }
                };
                
                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.updateConnectionStatus('offline', 'Connection Error');
                };
            }
            
            handleWebSocketMessage(data) {
                switch(data.type) {
                    case 'stock_update':
                        this.handleStockUpdate(data.data);
                        break;
                    case 'sale_update':
                        this.handleSaleUpdate(data.data);
                        break;
                    case 'audit_update':
                        this.handleAuditUpdate(data.data);
                        break;
                    case 'notification':
                        this.showRealtimeNotification(data.message);
                        break;
                    case 'sync_request':
                        this.handleSyncRequest(data);
                        break;
                }
            }
            
            handleStockUpdate(stockData) {
                // Update local cache
                const index = this.cache.stockItems.findIndex(item => item.id === stockData.id);
                if (index !== -1) {
                    this.cache.stockItems[index] = stockData;
                } else {
                    this.cache.stockItems.push(stockData);
                }
                
                // Update UI if on stock page
                if (document.getElementById('stockInventoryPage').classList.contains('active')) {
                    this.renderTable();
                }
                
                // Update dashboard if on review page
                if (document.getElementById('reviewPage').classList.contains('active')) {
                    this.updateReviewDashboard();
                }
                
                this.showRealtimeNotification(`Stock updated: ${stockData.name}`);
            }
            
            handleSaleUpdate(saleData) {
                this.cache.sales.push(saleData);
                
                if (document.getElementById('reviewPage').classList.contains('active')) {
                    this.updateReviewDashboard();
                }
                
                this.showRealtimeNotification(`New sale: ${saleData.invoice_number}`);
            }
            
            handleAuditUpdate(auditData) {
                this.cache.audit.push(auditData);
                
                if (document.getElementById('auditPage').classList.contains('active')) {
                    this.runAuditReport();
                }
            }
            
            handleSyncRequest(data) {
                // Send sync data to other clients
                this.ws.send(JSON.stringify({
                    type: 'sync_response',
                    data: this.cache
                }));
            }
            
            updateConnectionStatus(status, message) {
                const statusElement = document.getElementById('wsStatus');
                const connectionStatus = document.getElementById('connectionStatus');
                
                statusElement.className = `ws-status ${status}`;
                statusElement.innerHTML = `<i class="fas fa-circle"></i> <span>${message}</span>`;
                
                if (connectionStatus) {
                    connectionStatus.textContent = message;
                }
            }
            
            showRealtimeNotification(message) {
                const notification = document.getElementById('realtimeNotification');
                const text = document.getElementById('notificationText');
                
                text.textContent = message;
                notification.style.display = 'flex';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            setupEventListeners() {
                // Fullscreen toggle
                document.getElementById('fullscreenToggle').addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                    } else {
                        document.exitFullscreen();
                    }
                });
                
                // Login
                document.getElementById('loginBtn').addEventListener('click', () => this.handleLogin());
                document.getElementById('password').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleLogin();
                });
                
                // Navigation
                const navButtons = {
                    'navRegisterStock': 'registerStockPage',
                    'navSales': 'salesPage',
                    'navCurrentStock': 'stockInventoryPage',
                    'navAddStock': 'addStockPage',
                    'navReduceStock': 'deductStockPage',
                    'navReview': 'reviewPage',
                    'navAudit': 'auditPage',
                    'navReports': 'reportsPage',
                    'navDataManagement': 'dataManagementPage'
                };
                
                Object.keys(navButtons).forEach(btnId => {
                    document.getElementById(btnId)?.addEventListener('click', () => {
                        this.openPage(navButtons[btnId]);
                    });
                });
                
                // Close buttons
                document.querySelectorAll('.close-full-screen').forEach(btn => {
                    btn.addEventListener('click', () => this.closeAllPages());
                });
                
                // Forms
                document.getElementById('stockForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveStockItem();
                });
                
                document.getElementById('salesForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveSale();
                });
                
                document.getElementById('addStockForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addStock();
                });
                
                document.getElementById('reduceStockForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.reduceStock();
                });
                
                // Guideline modal
                document.getElementById('guidelineBtn').addEventListener('click', () => {
                    document.getElementById('guidelineModal').classList.add('active');
                });
                
                document.getElementById('closeGuideline').addEventListener('click', () => {
                    document.getElementById('guidelineModal').classList.remove('active');
                });
                
                // Real-time calculations
                this.setupRealTimeCalculations();
            }
            
            setupRealTimeCalculations() {
                // Register stock form calculations
                const registerInputs = ['registeredToBaseFactor', 'displayToBaseFactor', 
                                      'initialQuantity', 'purchasePricePerDisplay', 
                                      'markup', 'sellingPricePerDisplay'];
                
                registerInputs.forEach(id => {
                    document.getElementById(id)?.addEventListener('input', () => {
                        this.updateUnitConversion();
                    });
                });
                
                document.getElementById('initialQuantityType')?.addEventListener('change', () => {
                    this.updateUnitConversion();
                });
                
                document.getElementById('applyMarkup')?.addEventListener('click', () => {
                    this.applyMarkup();
                });
            }
            
            updateUnitConversion() {
                const registeredToBaseFactor = parseFloat(document.getElementById('registeredToBaseFactor').value) || 1;
                const displayToBaseFactor = parseFloat(document.getElementById('displayToBaseFactor').value) || 1;
                const quantityType = document.getElementById('initialQuantityType').value;
                const quantity = parseFloat(document.getElementById('initialQuantity').value) || 0;
                
                let baseQuantity = 0;
                let displayQuantity = 0;
                let registeredQuantity = 0;
                
                switch(quantityType) {
                    case 'registered':
                        baseQuantity = quantity * registeredToBaseFactor;
                        registeredQuantity = quantity;
                        displayQuantity = baseQuantity / displayToBaseFactor;
                        break;
                    case 'display':
                        baseQuantity = quantity * displayToBaseFactor;
                        displayQuantity = quantity;
                        registeredQuantity = baseQuantity / registeredToBaseFactor;
                        break;
                    case 'base':
                        baseQuantity = quantity;
                        displayQuantity = quantity / displayToBaseFactor;
                        registeredQuantity = quantity / registeredToBaseFactor;
                        break;
                }
                
                // Update displays
                document.getElementById('registeredConversionDisplay').textContent = 
                    `1 registered unit = ${registeredToBaseFactor} base units`;
                document.getElementById('displayConversionDisplay').textContent = 
                    `1 display unit = ${displayToBaseFactor} base units`;
                document.getElementById('baseQuantityDisplay').textContent = 
                    `${baseQuantity} base units`;
                
                // Update mixed unit display
                const allowFractional = document.getElementById('allowFractionalDisplay').value === 'true';
                const mixedDisplay = this.calculateMixedUnitDisplay(baseQuantity, registeredToBaseFactor, displayToBaseFactor, allowFractional);
                document.getElementById('mixedUnitDisplay').textContent = mixedDisplay;
                
                // Update quantity conversion display
                let displayText = "";
                switch(quantityType) {
                    case 'registered':
                        displayText = `${quantity} registered units = ${baseQuantity} base units = ${displayQuantity.toFixed(2)} display units`;
                        break;
                    case 'display':
                        displayText = `${quantity} display units = ${baseQuantity} base units = ${registeredQuantity.toFixed(2)} registered units`;
                        break;
                    case 'base':
                        displayText = `${quantity} base units = ${displayQuantity.toFixed(2)} display units = ${registeredQuantity.toFixed(2)} registered units`;
                        break;
                    default:
                        displayText = "Select quantity type";
                }
                document.getElementById('quantityConversionDisplay').textContent = displayText;
                
                // Update total value
                this.updateTotalValue();
            }
            
            calculateMixedUnitDisplay(baseQuantity, registeredToBaseFactor, displayToBaseFactor, allowFractional) {
                if (baseQuantity <= 0) return "No units";
                
                const registeredUnits = Math.floor(baseQuantity / registeredToBaseFactor);
                let remainingBase = baseQuantity % registeredToBaseFactor;
                
                const displayUnits = allowFractional ? 
                    (remainingBase / displayToBaseFactor) : 
                    Math.floor(remainingBase / displayToBaseFactor);
                
                remainingBase = allowFractional ? 0 : remainingBase % displayToBaseFactor;
                
                let result = "";
                if (registeredUnits > 0) {
                    result += `${registeredUnits} registered unit${registeredUnits !== 1 ? 's' : ''}`;
                }
                if (displayUnits > 0) {
                    if (result) result += " + ";
                    result += `${allowFractional ? displayUnits.toFixed(2) : displayUnits} display unit${displayUnits !== 1 ? 's' : ''}`;
                }
                if (remainingBase > 0) {
                    if (result) result += " + ";
                    result += `${remainingBase} base unit${remainingBase !== 1 ? 's' : ''}`;
                }
                
                return result || "0 units";
            }
            
            applyMarkup() {
                const unitPrice = parseFloat(document.getElementById('purchasePricePerDisplay').value) || 0;
                const markup = parseFloat(document.getElementById('markup').value) || 0;
                const sellingPrice = unitPrice * (1 + markup / 100);
                document.getElementById('sellingPricePerDisplay').value = sellingPrice.toFixed(2);
                this.updateSellingPriceDisplay();
                this.updateTotalValue();
            }
            
            updateSellingPriceDisplay() {
                const unitPrice = parseFloat(document.getElementById('purchasePricePerDisplay').value) || 0;
                const sellingPrice = parseFloat(document.getElementById('sellingPricePerDisplay').value) || 0;
                const markup = parseFloat(document.getElementById('markup').value) || 0;
                const percentage = unitPrice > 0 ? ((sellingPrice - unitPrice) / unitPrice * 100).toFixed(1) : '0';
                document.getElementById('sellingPriceDisplay').textContent = 
                    `ETB ${sellingPrice.toFixed(2)} (${percentage}% markup)`;
            }
            
            updateTotalValue() {
                const quantityType = document.getElementById('initialQuantityType').value;
                const quantity = parseFloat(document.getElementById('initialQuantity').value) || 0;
                const registeredToBaseFactor = parseFloat(document.getElementById('registeredToBaseFactor').value) || 1;
                const displayToBaseFactor = parseFloat(document.getElementById('displayToBaseFactor').value) || 1;
                const sellingPrice = parseFloat(document.getElementById('sellingPricePerDisplay').value) || 0;
                
                let baseQuantity = 0;
                switch(quantityType) {
                    case 'registered':
                        baseQuantity = quantity * registeredToBaseFactor;
                        break;
                    case 'display':
                        baseQuantity = quantity * displayToBaseFactor;
                        break;
                    case 'base':
                        baseQuantity = quantity;
                        break;
                }
                
                const displayQuantity = baseQuantity / displayToBaseFactor;
                const totalValue = displayQuantity * sellingPrice;
                
                document.getElementById('totalValueCalc').textContent = 
                    `ETB ${totalValue.toFixed(2)} (${baseQuantity} base units)`;
            }
            
            async handleLogin() {
                const loginType = document.getElementById('loginType').value;
                const password = document.getElementById('password').value;
                
                if (!loginType) {
                    this.showToast('Please select login type', 'warning');
                    return;
                }
                
                // Simple password check (in production, use proper authentication)
                if ((loginType === 'user' && password === '123456') || 
                    (loginType === 'admin' && password === 'esubalew2123')) {
                    
                    this.isAuthenticated = true;
                    this.userType = loginType;
                    this.userName = loginType === 'admin' ? 'Esubalew Biyazin' : 'User';
                    
                    // Update WebSocket authentication
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'auth',
                            userType: this.userType,
                            userName: this.userName
                        }));
                    }
                    
                    this.showLoginSuccess();
                } else {
                    this.showToast('Invalid password. Please try again.', 'warning');
                }
            }
            
            showLoginSuccess() {
                document.getElementById('welcomePage').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('welcomePage').style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    this.setupUserInterface();
                    this.showToast('Login successful! Welcome to Bete-Saida Pharmacy System.', 'success');
                    
                    // Load initial data
                    this.loadInitialData();
                }, 300);
            }
            
            setupUserInterface() {
                if (this.userType === 'user') {
                    document.querySelectorAll('.user-nav-btn').forEach(btn => {
                        btn.style.display = 'block';
                    });
                    document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                        if (!btn.classList.contains('user-nav-btn')) {
                            btn.style.display = 'none';
                        }
                    });
                } else if (this.userType === 'admin') {
                    document.querySelectorAll('.user-nav-btn, .admin-nav-btn').forEach(btn => {
                        btn.style.display = 'block';
                    });
                }
            }
            
            async loadInitialData() {
                try {
                    // Load stock items
                    const { data: stockItems, error: stockError } = await this.supabase
                        .from('stock_items')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (!stockError) {
                        this.cache.stockItems = stockItems;
                    }
                    
                    // Load categories
                    const { data: categories, error: catError } = await this.supabase
                        .from('categories')
                        .select('*');
                    
                    if (!catError) {
                        this.cache.categories = categories;
                    }
                    
                    // Update category dropdowns
                    this.updateCategoryLists();
                    
                } catch (error) {
                    console.log('Error loading initial data:', error);
                }
            }
            
            updateCategoryLists() {
                // Update category datalist
                const categoryList = document.getElementById('categoryList');
                if (categoryList) {
                    categoryList.innerHTML = '';
                    this.cache.categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        categoryList.appendChild(option);
                    });
                }
            }
            
            openPage(pageId) {
                if (!this.isAuthenticated) {
                    this.showToast('Please login first', 'warning');
                    return;
                }
                
                this.closeAllPages();
                const page = document.getElementById(pageId);
                if (page) {
                    page.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    switch(pageId) {
                        case 'registerStockPage':
                            this.initRegisterPage();
                            break;
                        case 'salesPage':
                            this.initSalesPage();
                            break;
                        case 'stockInventoryPage':
                            setTimeout(() => this.renderTable(), 50);
                            break;
                        case 'addStockPage':
                            this.initAddStockPage();
                            break;
                        case 'deductStockPage':
                            this.initDeductStockPage();
                            break;
                        case 'reviewPage':
                            this.updateReviewDashboard();
                            break;
                        case 'auditPage':
                            this.initAuditPage();
                            break;
                        case 'reportsPage':
                            this.initReportsPage();
                            break;
                        case 'dataManagementPage':
                            this.initDataManagementPage();
                            break;
                    }
                }
            }
            
            closeAllPages() {
                document.querySelectorAll('.full-screen-mode').forEach(page => {
                    page.classList.remove('active');
                });
                document.body.style.overflow = 'auto';
            }
            
            initRegisterPage() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('expiryDate').value = today;
                document.getElementById('markup').value = this.settings.defaultMarkup;
                document.getElementById('registeredToBaseFactor').value = 1;
                document.getElementById('displayToBaseFactor').value = 1;
                document.getElementById('allowFractionalDisplay').value = 'false';
                this.clearForm();
            }
            
            async saveStockItem() {
                const registeredToBaseFactor = parseFloat(document.getElementById('registeredToBaseFactor').value) || 1;
                const displayToBaseFactor = parseFloat(document.getElementById('displayToBaseFactor').value) || 1;
                const quantityType = document.getElementById('initialQuantityType').value;
                const quantity = parseFloat(document.getElementById('initialQuantity').value) || 0;
                
                if (registeredToBaseFactor <= 0 || displayToBaseFactor <= 0) {
                    this.showToast('Conversion factors must be greater than 0', 'warning');
                    return;
                }
                
                let baseQuantity = 0;
                switch(quantityType) {
                    case 'registered':
                        baseQuantity = quantity * registeredToBaseFactor;
                        break;
                    case 'display':
                        baseQuantity = quantity * displayToBaseFactor;
                        break;
                    case 'base':
                        baseQuantity = quantity;
                        break;
                }
                
                const itemData = {
                    name: document.getElementById('itemName').value.trim(),
                    category: document.getElementById('category').value,
                    base_unit: document.getElementById('baseUnit').value,
                    registered_unit: document.getElementById('registeredUnit').value.trim(),
                    registered_to_base_factor: registeredToBaseFactor,
                    display_unit: document.getElementById('displayUnit').value.trim(),
                    display_to_base_factor: displayToBaseFactor,
                    allow_fractional_display: document.getElementById('allowFractionalDisplay').value === 'true',
                    quantity_base: baseQuantity,
                    purchase_price_per_display: parseFloat(document.getElementById('purchasePricePerDisplay').value) || 0,
                    markup: parseFloat(document.getElementById('markup').value) || 0,
                    selling_price_per_display: parseFloat(document.getElementById('sellingPricePerDisplay').value) || 0,
                    batch_number: document.getElementById('batchNumber').value.trim(),
                    expiry_date: document.getElementById('expiryDate').value,
                    supplier: document.getElementById('supplier').value.trim(),
                    registrant: document.getElementById('registrant').value.trim(),
                    branch: document.getElementById('branch').value,
                    storage_location: document.getElementById('storageLocation').value.trim(),
                    min_stock_base: parseInt(document.getElementById('minStockBase').value) || 10,
                    max_stock_base: parseInt(document.getElementById('maxStockBase').value) || 100,
                    created_by: this.userName
                };
                
                if (!itemData.name || !itemData.category || !itemData.base_unit || 
                    !itemData.registered_unit || !itemData.display_unit || 
                    baseQuantity < 0 || !itemData.batch_number || !itemData.supplier || 
                    !itemData.registrant) {
                    this.showToast('Please fill all required fields correctly', 'warning');
                    return;
                }
                
                try {
                    const { data, error } = await this.supabase
                        .from('stock_items')
                        .insert([itemData])
                        .select();
                    
                    if (error) throw error;
                    
                    // Update cache
                    this.cache.stockItems.unshift(data[0]);
                    
                    // Broadcast via WebSocket
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'stock_update',
                            data: data[0]
                        }));
                    }
                    
                    this.showToast('Item registered successfully!', 'success');
                    this.clearForm();
                    
                    // Record audit
                    await this.recordAudit({
                        action: 'create',
                        item_id: data[0].id,
                        item_name: data[0].name,
                        quantity: data[0].quantity_base,
                        event_type: 'item_registered',
                        branch: data[0].branch,
                        user: this.userName,
                        details: {
                            category: data[0].category,
                            batch: data[0].batch_number
                        }
                    });
                    
                } catch (error) {
                    console.error('Error saving item:', error);
                    this.showToast('Error saving item. Please try again.', 'danger');
                }
            }
            
            clearForm() {
                document.getElementById('stockForm').reset();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('expiryDate').value = today;
                document.getElementById('markup').value = this.settings.defaultMarkup;
                document.getElementById('registeredToBaseFactor').value = 1;
                document.getElementById('displayToBaseFactor').value = 1;
                document.getElementById('allowFractionalDisplay').value = 'false';
                document.getElementById('minStockBase').value = 10;
                document.getElementById('maxStockBase').value = 100;
                this.updateUnitConversion();
                this.updateTotalValue();
                this.updateSellingPriceDisplay();
            }
            
            async renderTable(searchTerm = '') {
                const tbody = document.getElementById('stockTableBody');
                const noData = document.getElementById('noData');
                
                if (!tbody) return;
                
                let filteredItems = [...this.cache.stockItems];
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filteredItems = filteredItems.filter(item =>
                        item.name.toLowerCase().includes(term) ||
                        (item.batch_number && item.batch_number.toLowerCase().includes(term)) ||
                        (item.supplier && item.supplier.toLowerCase().includes(term)) ||
                        (item.registered_unit && item.registered_unit.toLowerCase().includes(term))
                    );
                }
                
                // Apply filters
                const categoryFilter = document.getElementById('categoryFilter')?.value;
                if (categoryFilter) {
                    filteredItems = filteredItems.filter(item => item.category === categoryFilter);
                }
                
                const branchFilter = document.getElementById('branchFilter')?.value;
                if (branchFilter) {
                    filteredItems = filteredItems.filter(item => item.branch === branchFilter);
                }
                
                const statusFilter = document.getElementById('statusFilter')?.value;
                if (statusFilter) {
                    filteredItems = filteredItems.filter(item => {
                        switch(statusFilter) {
                            case 'low':
                                return item.quantity_base > 0 && item.quantity_base < (item.min_stock_base || this.settings.lowStockThreshold);
                            case 'over':
                                return item.quantity_base > (item.max_stock_base || 100);
                            case 'expiry':
                                const expiryDate = new Date(item.expiry_date);
                                const today = new Date();
                                const diffTime = expiryDate - today;
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                return diffDays > 0 && diffDays <= this.settings.expiryWarningDays;
                            case 'expired':
                                const expiry = new Date(item.expiry_date);
                                return expiry < new Date();
                            case 'stockout':
                                return item.quantity_base <= 0;
                            case 'negative':
                                const margin = item.purchase_price_per_display > 0 ? 
                                    ((item.selling_price_per_display - item.purchase_price_per_display) / item.purchase_price_per_display * 100) : 0;
                                return margin < 0;
                            default:
                                return true;
                        }
                    });
                }
                
                this.updateCategoryFilter();
                
                if (filteredItems.length === 0) {
                    tbody.innerHTML = '';
                    if (noData) noData.style.display = 'block';
                    return;
                }
                
                if (noData) noData.style.display = 'none';
                tbody.innerHTML = filteredItems.map(item => this.createTableRow(item)).join('');
                this.attachRowEventListeners();
            }
            
            createTableRow(item) {
                const displayQuantity = item.quantity_base / item.display_to_base_factor;
                const totalValue = displayQuantity * item.selling_price_per_display;
                const margin = item.purchase_price_per_display > 0 ? 
                    ((item.selling_price_per_display - item.purchase_price_per_display) / item.purchase_price_per_display * 100) : 0;
                const statusClass = this.getStatusClass(item);
                const branchNames = {
                    'merkeb': 'Merkeb Jabo',
                    'no1': 'Bete‑Saida No.1',
                    'no2': 'Bete‑Saida No.2'
                };
                
                const expiryDate = new Date(item.expiry_date);
                const formattedDate = expiryDate.toLocaleDateString();
                const today = new Date();
                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let expiryStatus = '';
                if (diffDays < 0) {
                    expiryStatus = '<span style="color: var(--danger);">EXPIRED</span>';
                } else if (diffDays <= 30) {
                    expiryStatus = `<span style="color: #ff7700;">${diffDays}d</span>`;
                } else if (diffDays <= 60) {
                    expiryStatus = `<span style="color: var(--warning);">${diffDays}d</span>`;
                }
                
                const mixedDisplay = this.calculateMixedUnitDisplay(
                    item.quantity_base, 
                    item.registered_to_base_factor, 
                    item.display_to_base_factor, 
                    item.allow_fractional_display
                );
                
                return `
                    <tr data-id="${item.id}">
                        <td><strong style="color: var(--gold);">${item.name}</strong></td>
                        <td>${item.category || 'N/A'}</td>
                        <td>${item.base_unit}</td>
                        <td>${item.registered_unit || 'N/A'}</td>
                        <td>${item.registered_to_base_factor}</td>
                        <td>${item.display_unit}</td>
                        <td>${item.display_to_base_factor}</td>
                        <td><strong>${item.quantity_base}</strong></td>
                        <td><strong>${displayQuantity.toFixed(2)}</strong></td>
                        <td><small>${mixedDisplay}</small></td>
                        <td>${item.min_stock_base || 10}/${item.max_stock_base || 100}</td>
                        <td>ETB ${item.purchase_price_per_display.toFixed(2)}</td>
                        <td>ETB ${item.selling_price_per_display.toFixed(2)}</td>
                        <td style="color: ${margin >= 0 ? 'var(--success)' : 'var(--danger)'};">
                            <strong>${margin.toFixed(1)}%</strong>
                        </td>
                        <td><strong style="color: var(--gold);">ETB ${totalValue.toFixed(2)}</strong></td>
                        <td>${item.batch_number}</td>
                        <td>${branchNames[item.branch] || item.branch}</td>
                        <td>
                            <span class="status-indicator ${statusClass}"></span> 
                            ${formattedDate}
                            ${expiryStatus}
                        </td>
                        <td>${item.allow_fractional_display ? 'Yes' : 'No'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit" title="Edit Item">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn add" title="Add Stock">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="action-btn reduce" title="Reduce Stock">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            getStatusClass(item) {
                if (item.quantity_base <= 0) return 'status-out';
                
                const expiryDate = new Date(item.expiry_date);
                const today = new Date();
                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) return 'status-expired';
                if (diffDays <= 30) return 'status-near-expiry';
                if (diffDays <= 60) return 'status-warning';
                if (item.quantity_base < (item.min_stock_base || this.settings.lowStockThreshold)) return 'status-low';
                if (item.quantity_base > (item.max_stock_base || 100)) return 'status-reorder';
                
                return 'status-instock';
            }
            
            attachRowEventListeners() {
                // Edit button
                document.querySelectorAll('.action-btn.edit').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const row = e.target.closest('tr');
                        const itemId = parseInt(row.dataset.id);
                        await this.editItem(itemId);
                    });
                });
                
                // Add stock button
                document.querySelectorAll('.action-btn.add').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const row = e.target.closest('tr');
                        const itemId = parseInt(row.dataset.id);
                        this.openPage('addStockPage');
                        setTimeout(() => {
                            document.getElementById('addItemSelect').value = itemId;
                            this.updateAddStockDetails();
                        }, 50);
                    });
                });
                
                // Reduce stock button
                document.querySelectorAll('.action-btn.reduce').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const row = e.target.closest('tr');
                        const itemId = parseInt(row.dataset.id);
                        this.openPage('deductStockPage');
                        setTimeout(() => {
                            document.getElementById('reduceItemSelect').value = itemId;
                            this.updateDeductStockDetails();
                        }, 50);
                    });
                });
            }
            
            async editItem(itemId) {
                const item = this.cache.stockItems.find(i => i.id === itemId);
                if (!item) return;
                
                this.openPage('registerStockPage');
                setTimeout(() => {
                    document.getElementById('itemName').value = item.name;
                    document.getElementById('category').value = item.category || '';
                    document.getElementById('baseUnit').value = item.base_unit;
                    document.getElementById('registeredUnit').value = item.registered_unit || '';
                    document.getElementById('registeredToBaseFactor').value = item.registered_to_base_factor;
                    document.getElementById('displayUnit').value = item.display_unit;
                    document.getElementById('displayToBaseFactor').value = item.display_to_base_factor;
                    document.getElementById('allowFractionalDisplay').value = item.allow_fractional_display ? 'true' : 'false';
                    document.getElementById('initialQuantityType').value = 'base';
                    document.getElementById('initialQuantity').value = item.quantity_base;
                    document.getElementById('purchasePricePerDisplay').value = item.purchase_price_per_display;
                    document.getElementById('markup').value = item.markup || this.settings.defaultMarkup;
                    document.getElementById('sellingPricePerDisplay').value = item.selling_price_per_display;
                    document.getElementById('batchNumber').value = item.batch_number;
                    document.getElementById('expiryDate').value = item.expiry_date;
                    document.getElementById('supplier').value = item.supplier;
                    document.getElementById('registrant').value = item.registrant || '';
                    document.getElementById('branch').value = item.branch;
                    document.getElementById('storageLocation').value = item.storage_location || '';
                    document.getElementById('minStockBase').value = item.min_stock_base || 10;
                    document.getElementById('maxStockBase').value = item.max_stock_base || 100;
                    
                    document.getElementById('saveBtn').innerHTML = '<i class="fas fa-sync-alt"></i> Update Item';
                    this.updateUnitConversion();
                    this.updateTotalValue();
                    this.updateSellingPriceDisplay();
                }, 50);
            }
            
            updateCategoryFilter() {
                const categoryFilter = document.getElementById('categoryFilter');
                if (!categoryFilter) return;
                
                const currentValue = categoryFilter.value;
                const categories = [...new Set(this.cache.stockItems.map(item => item.category).filter(Boolean))];
                
                categories.sort();
                
                categoryFilter.innerHTML = '<option value="">All Categories</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    if (category === currentValue) option.selected = true;
                    categoryFilter.appendChild(option);
                });
            }
            
            async updateReviewDashboard() {
                // Implementation for review dashboard
                // This would calculate and display various metrics
            }
            
            async recordAudit(auditData) {
                try {
                    const { data, error } = await this.supabase
                        .from('audit_trail')
                        .insert([{
                            ...auditData,
                            created_at: new Date().toISOString()
                        }]);
                    
                    if (error) throw error;
                    
                    // Broadcast via WebSocket
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'audit_update',
                            data: auditData
                        }));
                    }
                    
                } catch (error) {
                    console.error('Error recording audit:', error);
                }
            }
            
            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                     type === 'warning' ? 'exclamation-triangle' : 
                                     type === 'danger' ? 'exclamation-circle' : 
                                     'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                    toast.style.opacity = '1';
                }, 10);
                
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (toastContainer.contains(toast)) {
                            toastContainer.removeChild(toast);
                        }
                    }, 400);
                }, 3000);
            }
            
            // More methods for sales, add stock, reduce stock, etc. would follow similar patterns
            
            initSalesPage() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('salesDate').value = today;
                this.clearSalesForm();
                this.addSalesRow();
            }
            
            initAddStockPage() {
                const select = document.getElementById('addItemSelect');
                select.innerHTML = '<option value="">Choose an item...</option>';
                this.cache.stockItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    const displayQuantity = item.quantity_base / item.display_to_base_factor;
                    option.textContent = `${item.name} (${displayQuantity.toFixed(2)} ${item.display_unit} available)`;
                    option.dataset.baseUnit = item.base_unit;
                    option.dataset.registeredUnit = item.registered_unit;
                    option.dataset.registeredToBaseFactor = item.registered_to_base_factor;
                    option.dataset.displayUnit = item.display_unit;
                    option.dataset.displayToBaseFactor = item.display_to_base_factor;
                    option.dataset.allowFractional = item.allow_fractional_display;
                    option.dataset.purchasePrice = item.purchase_price_per_display;
                    option.dataset.sellingPrice = item.selling_price_per_display;
                    option.dataset.supplier = item.supplier;
                    option.dataset.batch = item.batch_number;
                    option.dataset.expiry = item.expiry_date;
                    option.dataset.storage = item.storage_location || '';
                    select.appendChild(option);
                });
                
                select.addEventListener('change', () => this.updateAddStockDetails());
                document.getElementById('addMarkup').value = this.settings.defaultMarkup;
                this.clearAddStockForm();
            }
            
            initDeductStockPage() {
                const select = document.getElementById('reduceItemSelect');
                select.innerHTML = '<option value="">Choose an item...</option>';
                this.cache.stockItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    const displayQuantity = item.quantity_base / item.display_to_base_factor;
                    option.textContent = `${item.name} (${displayQuantity.toFixed(2)} ${item.display_unit} available)`;
                    option.dataset.quantityBase = item.quantity_base;
                    option.dataset.displayUnit = item.display_unit;
                    option.dataset.baseUnit = item.base_unit;
                    option.dataset.displayToBaseFactor = item.display_to_base_factor;
                    select.appendChild(option);
                });
                
                select.addEventListener('change', () => this.updateDeductStockDetails());
                this.clearDeductStockForm();
            }
            
            initAuditPage() {
                this.updateAuditAlerts();
                this.updateAuditSummary();
                this.runAuditReport();
            }
            
            initReportsPage() {
                const reportCategory = document.getElementById('reportCategory');
                if (reportCategory) {
                    const categories = [...new Set(this.cache.stockItems.map(item => item.category).filter(Boolean))];
                    categories.sort();
                    reportCategory.innerHTML = '<option value="">All Categories</option>';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        reportCategory.appendChild(option);
                    });
                }
                
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 30);
                const startDateStr = startDate.toISOString().split('T')[0];
                
                document.getElementById('reportStartDate').value = startDateStr;
                document.getElementById('reportEndDate').value = endDate;
            }
            
            initDataManagementPage() {
                document.getElementById('statTotalItems').textContent = this.cache.stockItems.length;
                // Load other stats
                this.updateSettingsUI();
            }
        }
        
        // Initialize the system when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.pharmacySystem = new PharmacyManagementSystem();
        });
    </script>
</body>
</html>